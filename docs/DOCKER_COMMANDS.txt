# ==================================================
# MULTI-DATABASE CONTACT MANAGER - DOCKER COMMANDS
# ==================================================
# Copy and use these commands for your Docker setup
# All credentials: contact_user / contact_password
# Adminer: http://localhost:8050

# =============== START APPLICATION ===============

# Quick start (recommended) - starts everything
./start-docker-app.sh

# Manual start with build
docker compose --profile full up --build

# Start in background
docker compose --profile full up -d --build

# ============= START DATABASES ONLY =============

# Databases + Adminer only
./start-databases-only.sh

# Manual databases only
docker compose up -d mysql postgres mongodb adminer

# ================= STOP APPLICATION ==============

# Stop all containers (keeps data)
docker compose down

# Stop and DELETE ALL DATA (DANGER!)
docker compose down -v

# Stop running application
# Press Ctrl+C in terminal

# ================ CHECK STATUS ================

# Show running containers
docker compose ps

# Show all logs
docker compose logs

# Show app logs only
docker compose logs contact-manager

# Follow logs live
docker compose logs -f

# =============== DATABASE ACCESS ===============

# MySQL direct access
docker exec -it contact-mysql mysql -u contact_user -pcontact_password contacts

# PostgreSQL direct access
docker exec -it contact-postgres psql -U contact_user -d contacts

# MongoDB direct access
docker exec -it contact-mongodb mongosh contacts

# ============== WEB INTERFACES ==============

# Adminer (Database Admin Web UI)
# Open in browser: http://localhost:8050
# Login credentials:
# MySQL:     contact_user / contact_password
# PostgreSQL: contact_user / contact_password
# MongoDB:   (leave empty) / (leave empty)

# ============== BACKUP DATABASES ==============

# Backup MySQL
docker exec contact-mysql mysqldump -u contact_user -pcontact_password contacts > mysql_backup.sql

# Backup PostgreSQL
docker exec contact-postgres pg_dump -U contact_user contacts > postgres_backup.sql

# Backup MongoDB
docker exec contact-mongodb mongodump --db contacts --out /tmp/backup

# ============= RESTORE DATABASES ==============

# Restore MySQL
docker exec -i contact-mysql mysql -u contact_user -pcontact_password contacts < mysql_backup.sql

# Restore PostgreSQL
docker exec -i contact-postgres psql -U contact_user contacts < postgres_backup.sql

# Restore MongoDB
docker exec contact-mongodb mongorestore --db contacts /tmp/backup/contacts

# ============ CHECK DATABASE CONTENT ============

# Check MySQL contacts count
docker exec contact-mysql mysql -u contact_user -pcontact_password -e 'SELECT COUNT(*) FROM contacts;' contacts

# Check PostgreSQL contacts count
docker exec contact-postgres psql -U contact_user -c 'SELECT COUNT(*) FROM contacts;' contacts

# Check MongoDB contacts count
docker exec contact-mongodb mongosh --eval 'db.contacts.countDocuments({})' contacts

# ============= MANAGEMENT COMMANDS ==============

# Restart app only
docker compose restart contact-manager

# Rebuild app after code changes
docker compose build contact-manager

# Test database connections
docker compose exec contact-mysql mysqladmin ping -u contact_user -pcontact_password
docker compose exec contact-postgres pg_isready -U contact_user

# =============== CLEANUP COMMANDS ===============

# Remove unused containers
docker system prune

# Remove unused volumes
docker volume prune

# Remove orphaned containers
docker compose down --remove-orphans

# ================ MONITORING =================

# Resource usage
docker stats

# Disk usage by volumes
docker system df -v

# Process list per container
docker compose top

# ============ DEVELOPMENT WORKFLOW ============

# Make code changes
nano main.py

# Rebuild and restart app
docker compose build contact-manager
docker compose restart contact-manager

# Full restart after changes
docker compose down && ./start-docker-app.sh

# ============= DANGER ZONE (USE CAREFULLY) ============

# DELETES ALL DATABASE DATA PERMANENTLY!
docker compose down -v

# Remove all unused Docker images
docker system prune -a

# Remove all volumes (including data)
docker volume prune -f

# ==================================================
# QUICK REFERENCE
# ==================================================

# START:    ./start-docker-app.sh
# STOP:     docker compose down
# STATUS:   docker compose ps
# LOGS:     docker compose logs -f
# ADMINER:  http://localhost:8050

# DATABASE CREDENTIALS:
# Username: contact_user
# Password: contact_password
# Database: contacts

# PORTS:
# Adminer:    8050
# PostgreSQL: 5433
# MySQL:      3306
# MongoDB:    27017

# ==================================================
